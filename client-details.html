<!-- client-details.html -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل العميل</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet>
    <style>
        /* Add detailed client styling */
    </style>
</head>
<body>
    <div id="client-details">
        <!-- Client details will be loaded here -->
    </div>

    <script>
        const clientName = localStorage.getItem('currentClient');
        const clients = JSON.parse(localStorage.getItem('clients') || '[]');
        const client = clients.find(c => c.name === clientName);

        document.getElementById('client-details').innerHTML = `
            <h2>${client.name}</h2>
            ${client.projects.map(project => `
                <div class="project">
                    <h3>${project.name}</h3>
                    <input type="range" 
                           value="${project.progress}" 
                           onchange="updateProgress('${client.name}', '${project.name}', this.value)">
                    <span>${project.progress}%</span>
                    <input type="file" accept="image/*" onchange="uploadPhoto('${client.name}', '${project.name}', this)">
                    <div class="gallery">
                        ${project.updates.flatMap(update => 
                            update.photos.map(photo => `
                                <img src="${photo}" alt="صورة المشروع">
                            `)
                        ).join('')}
                    </div>
                </div>
            `).join('')}
        `;

        function updateProgress(clientName, projectName, progress) {
            const clients = JSON.parse(localStorage.getItem('clients'));
            const project = clients.find(c => c.name === clientName)
                              .projects.find(p => p.name === projectName);
            project.progress = progress;
            localStorage.setItem('clients', JSON.stringify(clients));
        }

        function uploadPhoto(clientName, projectName, input) {
            const file = input.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const clients = JSON.parse(localStorage.getItem('clients'));
                const project = clients.find(c => c.name === clientName)
                                  .projects.find(p => p.name === projectName);
                
                project.updates.push({
                    date: new Date().toLocaleDateString(),
                    photos: [e.target.result]
                });
                
                localStorage.setItem('clients', JSON.stringify(clients));
                window.location.reload();
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>